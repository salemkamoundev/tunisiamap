------------------------------
ðŸ“„ Fichier : src/index.html
------------------------------
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>TunisiaMapProject</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
</head>
<body>
  <app-root></app-root>
</body>
</html>

------------------------------
ðŸ“„ Fichier : src/app/app.component.html
------------------------------
<div class="map-container">
  
  <div class="map-controls">
    <div class="main-select">
      <label><strong>CatÃ©gorie :</strong></label>
      <select (change)="onCategoryChange($any($event))">
        <option *ngFor="let cat of categories" [value]="cat">
          {{ cat }}
        </option>
      </select>
    </div>

    <div *ngIf="isBudgetActive" class="filter-container">
      <hr>
      <div class="filter-header">
        <strong>Filtres Budget</strong>
        <button class="toggle-btn" (click)="filtersVisible = !filtersVisible">
          {{ filtersVisible ? 'Masquer' : 'Afficher' }}
        </button>
      </div>

      <div *ngIf="filtersVisible" class="filter-body">
        
        <div class="filter-group">
          <label>Gouvernorat :</label>
          <select [(ngModel)]="selectedGov" (change)="applyBudgetFilters()">
            <option value="">(Tous)</option>
            <option *ngFor="let g of listGouvernorats" [value]="g">{{ g }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>MunicipalitÃ© :</label>
          <select [(ngModel)]="selectedMun" (change)="applyBudgetFilters()">
            <option value="">(Toutes)</option>
            <option *ngFor="let m of listMunicipalites" [value]="m">{{ m }}</option>
          </select>
        </div>

        <button class="reset-btn" (click)="resetFilters()">RÃ©initialiser</button>
      </div>
    </div>
  </div>

  <div id="map"></div>
</div>

------------------------------
ðŸ“„ Fichier : src/app/app.ts
------------------------------
import { Component, AfterViewInit } from '@angular/core';
import { CommonModule } from '@angular/common'; 
import { HttpClientModule } from '@angular/common/http';
import { FormsModule } from '@angular/forms'; 

import { MapDataService } from './services/map-data.service';

// On utilise le L global du CDN
declare const L: any;

@Component({
  selector: 'app-root',
  standalone: true,
  imports: [CommonModule, HttpClientModule, FormsModule],
  templateUrl: './app.html',
  styleUrls: ['./app.css'],
  providers: [MapDataService]
})
export class App implements AfterViewInit {
  map!: any;
  currentLayer: any = null;

  categories: string[] = [ 
    'Stade', 'LycÃ©e', 'Maison des Jeunes', 'Poste', 'UniversitÃ©', 'Ã‰cole', 'Budget 2021' 
  ];

  isBudgetActive: boolean = false;
  filtersVisible: boolean = true;
  
  allBudgetData: any[] = [];
  filteredBudgetData: any[] = [];
  
  listGouvernorats: string[] = [];
  listMunicipalites: string[] = [];
  
  selectedGov: string = '';
  selectedMun: string = '';

  constructor(private mapService: MapDataService) {}

  ngAfterViewInit() {
    this.initMap();
  }

  initMap() {
    // Initialisation manuelle
    this.map = L.map('map').setView([33.8869, 9.5375], 7);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(this.map);

    this.loadStandardData('Toutes');
  }

  onCategoryChange(event: any) {
    const selectedCat = event.target.value;
    this.isBudgetActive = (selectedCat === 'Budget 2021');

    if (this.currentLayer && this.map) {
      this.map.removeLayer(this.currentLayer);
      this.currentLayer = null;
    }

    if (this.isBudgetActive) {
      this.loadBudgetData();
    } else {
      this.loadStandardData(selectedCat);
    }
  }

  loadBudgetData() {
    this.mapService.getBudget2021().subscribe({
      next: (data) => {
        this.allBudgetData = data;
        this.extractFilterOptions();
        this.applyBudgetFilters();
      },
      error: (err) => console.error('Erreur Budget:', err)
    });
  }

  extractFilterOptions() {
    const govs = this.allBudgetData.map(item => item.Nom_Gouvernorat_Ar).filter(Boolean);
    this.listGouvernorats = [...new Set(govs)].sort();
    const muns = this.allBudgetData.map(item => item.Nom_Municipalite_Ar).filter(Boolean);
    this.listMunicipalites = [...new Set(muns)].sort();
  }

  applyBudgetFilters() {
    this.filteredBudgetData = this.allBudgetData.filter(item => {
      const matchGov = this.selectedGov ? item.Nom_Gouvernorat_Ar === this.selectedGov : true;
      const matchMun = this.selectedMun ? item.Nom_Municipalite_Ar === this.selectedMun : true;
      return matchGov && matchMun;
    });
    this.renderBudgetLayer(this.filteredBudgetData);
  }

  resetFilters() {
    this.selectedGov = '';
    this.selectedMun = '';
    this.applyBudgetFilters();
  }

  renderBudgetLayer(data: any[]) {
    if (this.currentLayer && this.map) {
      this.map.removeLayer(this.currentLayer);
    }

    const budgetCluster = L.markerClusterGroup({
      maxClusterRadius: 80,
      iconCreateFunction: (cluster: any) => {
        const markers = cluster.getAllChildMarkers();
        let totalPrevision = 0;
        const govs = new Set();
        const muns = new Set();

        markers.forEach((marker: any) => {
          if (marker.options.previsionAmount) totalPrevision += marker.options.previsionAmount;
          if (marker.options.govName) govs.add(marker.options.govName);
          if (marker.options.munName) muns.add(marker.options.munName);
        });

        let locationLabel = 'Zones Multiples';
        let locationClass = 'mixed';

        if (muns.size === 1) {
          locationLabel = [...muns][0] as string;
          locationClass = 'municipalite';
        } else if (govs.size === 1) {
          locationLabel = [...govs][0] as string;
          locationClass = 'gouvernorat';
        } else {
          locationLabel = 'Divers';
        }

        const formattedSum = new Intl.NumberFormat('fr-TN', { 
          style: 'currency', currency: 'TND', maximumFractionDigits: 0 
        }).format(totalPrevision);

        return L.divIcon({
          html: `<div class="budget-cluster-icon ${locationClass}">
                   <span class="amount">${formattedSum}</span>
                   <span class="location">${locationLabel}</span>
                   <small>(${markers.length} projets)</small>
                 </div>`,
          className: 'budget-cluster',
          iconSize: L.point(100, 100)
        });
      }
    });

    data.forEach(item => {
      const lat = parseFloat(item.lat);
      const lng = parseFloat(item.lng);
      const rawPrevision = item.depenses_prevision ? String(item.depenses_prevision) : '0';
      const valPrevision = parseFloat(rawPrevision.replace(/\s/g, '').replace(',', '.'));

      if (!isNaN(lat) && !isNaN(lng)) {
        const marker = L.marker([lat, lng], {
          icon: L.icon({
            iconUrl: 'assets/marker-icon.png',
            shadowUrl: 'assets/marker-shadow.png',
            iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34]
          })
        });
        
        (marker as any).options.previsionAmount = valPrevision;
        (marker as any).options.govName = item.Nom_Gouvernorat_Ar;
        (marker as any).options.munName = item.Nom_Municipalite_Ar;

        marker.bindPopup(this.generateFullPopup(item));
        budgetCluster.addLayer(marker);
      }
    });

    this.currentLayer = budgetCluster;
    this.map.addLayer(this.currentLayer);
    
    if (data.length > 0) {
        const bounds = budgetCluster.getBounds();
        if (bounds.isValid()) this.map.fitBounds(bounds);
    }
  }

  loadStandardData(category: string) {
    this.mapService.getLocations().subscribe({
      next: (locations) => {
        const filtered = category === 'Toutes' 
          ? locations 
          : locations.filter(l => l.categorie === category);

        const standardCluster = L.markerClusterGroup();

        if (filtered) {
          filtered.forEach(loc => {
            const marker = L.marker([loc.lat, loc.lng], {
              icon: L.icon({
                iconUrl: 'assets/marker-icon.png',
                shadowUrl: 'assets/marker-shadow.png',
                iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34]
              })
            });
            marker.bindPopup(`<b>${loc.nom}</b><br>${loc.categorie}`);
            standardCluster.addLayer(marker);
          });
        }
        this.currentLayer = standardCluster;
        this.map.addLayer(this.currentLayer);
        
        if (filtered && filtered.length > 0) {
           const bounds = standardCluster.getBounds();
           if(bounds.isValid()) this.map.fitBounds(bounds);
        }
      },
      error: (err) => console.error('Erreur Standard:', err)
    });
  }

  generateFullPopup(data: any): string {
    let rows = '';
    for (const key in data) {
      if (data.hasOwnProperty(key) && key !== 'lat' && key !== 'lng') {
         rows += `
          <tr>
            <td style="font-weight:bold; color:#555; padding:3px; border-bottom:1px solid #eee;">${key}</td>
            <td style="padding:3px; border-bottom:1px solid #eee;">${data[key]}</td>
          </tr>`;
      }
    }
    return `<div style="max-height:300px; overflow-y:auto; min-width:250px;">
              <h3 style="margin-top:0; color:#28a745; font-size:14px;">DÃ©tails</h3>
              <table style="width:100%; border-collapse:collapse; font-size:12px;"><tbody>${rows}</tbody></table>
            </div>`;
  }
}

------------------------------
ðŸ“„ Fichier : src/app/app.css
------------------------------
/* Layout Principal */
.map-container {
  position: relative;
  height: 100vh;
  width: 100%;
  display: flex;
  flex-direction: column;
}

#map {
  flex-grow: 1;
  width: 100%;
  height: 100%;
  z-index: 1;
}

/* ContrÃ´les */
.map-controls {
  position: absolute;
  top: 20px;
  right: 20px;
  z-index: 1000;
  background: white;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  font-family: 'Segoe UI', Arial, sans-serif;
  min-width: 250px;
  max-width: 300px;
}
.main-select select { width: 100%; padding: 6px; margin-top: 5px; }

/* Filtres */
.filter-container { margin-top: 10px; animation: fadeIn 0.3s ease-in-out; }
.filter-header { display: flex; justify-content: space-between; margin-bottom: 10px; color: #28a745; }
.toggle-btn { background: none; border: none; color: #007bff; font-size: 11px; cursor: pointer; text-decoration: underline; }
.filter-group { margin-bottom: 8px; }
.filter-group label { display: block; font-size: 12px; color: #555; }
.filter-group select { width: 100%; padding: 4px; }
.reset-btn { width: 100%; padding: 6px; margin-top: 5px; background-color: #f8f9fa; border: 1px solid #ddd; cursor: pointer; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

/* --- CLUSTER BUDGET --- */
::ng-deep .budget-cluster-icon {
  background-color: rgba(40, 167, 69, 0.95);
  border: 2px solid white;
  border-radius: 50%;
  color: white;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  /* Augmentation de la taille pour le texte */
  width: 100px; 
  height: 100px; 
  box-shadow: 0 5px 15px rgba(0,0,0,0.4);
  text-align: center;
  cursor: pointer;
  transition: transform 0.2s;
  padding: 5px; /* Padding interne */
  overflow: hidden;
}

::ng-deep .budget-cluster-icon:hover {
  background-color: #218838;
  transform: scale(1.1);
  z-index: 9999;
}

/* Montant */
::ng-deep .budget-cluster-icon .amount {
  font-weight: bold;
  font-size: 11px;
  line-height: 1.2;
}

/* Nom GÃ©ographique (Gouvernorat/MunicipalitÃ©) */
::ng-deep .budget-cluster-icon .location {
  font-size: 10px;
  font-weight: bold;
  color: #d4edda; /* Vert trÃ¨s clair */
  margin-top: 2px;
  margin-bottom: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 90%;
}

::ng-deep .budget-cluster-icon small {
  font-size: 9px;
  opacity: 0.8;
  font-weight: normal;
}

/* Variation de couleur subtile si c'est une municipalitÃ© prÃ©cise */
::ng-deep .budget-cluster-icon.municipalite {
  background-color: rgba(30, 126, 52, 0.95); /* Vert plus foncÃ© */
  border-color: #c3e6cb;
}

------------------------------
ðŸ“„ Fichier : src/app/app.component.ts
------------------------------
import { Component, AfterViewInit } from '@angular/core';
import { CommonModule } from '@angular/common'; 
import { HttpClientModule } from '@angular/common/http';
import { FormsModule } from '@angular/forms'; 
// On supprime LeafletModule, on va faire du JS pur pour la carte
// import { LeafletModule } from '@bluehalo/ngx-leaflet'; 

import { MapDataService } from './services/map-data.service';

// On dÃ©clare la variable globale L fournie par le CDN dans index.html
declare const L: any;

@Component({
  selector: 'app-root',
  standalone: true,
  imports: [CommonModule, HttpClientModule, FormsModule], // Plus de LeafletModule
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css'],
  providers: [MapDataService]
})
export class AppComponent implements AfterViewInit {
  map!: any;
  currentLayer: any = null;

  categories: string[] = [ 
    'Stade', 'LycÃ©e', 'Maison des Jeunes', 'Poste', 'UniversitÃ©', 'Ã‰cole', 'Budget 2021' 
  ];

  isBudgetActive: boolean = false;
  filtersVisible: boolean = true;
  
  allBudgetData: any[] = [];
  filteredBudgetData: any[] = [];
  
  listGouvernorats: string[] = [];
  listMunicipalites: string[] = [];
  
  selectedGov: string = '';
  selectedMun: string = '';

  constructor(private mapService: MapDataService) {}

  // Initialisation manuelle aprÃ¨s que la vue soit chargÃ©e
  ngAfterViewInit() {
    this.initMap();
  }

  initMap() {
    // On crÃ©e la carte manuellement sur la div id="map"
    this.map = L.map('map').setView([33.8869, 9.5375], 7);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(this.map);

    // On charge les donnÃ©es par dÃ©faut
    this.loadStandardData('Toutes');
  }

  onCategoryChange(event: any) {
    const selectedCat = event.target.value;
    
    this.isBudgetActive = (selectedCat === 'Budget 2021');

    if (this.currentLayer && this.map) {
      this.map.removeLayer(this.currentLayer);
      this.currentLayer = null;
    }

    if (this.isBudgetActive) {
      this.loadBudgetData();
    } else {
      this.loadStandardData(selectedCat);
    }
  }

  // --- LOGIQUE BUDGET ---
  loadBudgetData() {
    this.mapService.getBudget2021().subscribe({
      next: (data) => {
        this.allBudgetData = data;
        this.extractFilterOptions();
        this.applyBudgetFilters();
      },
      error: (err) => console.error('Erreur Budget:', err)
    });
  }

  extractFilterOptions() {
    const govs = this.allBudgetData.map(item => item.Nom_Gouvernorat_Ar).filter(Boolean);
    this.listGouvernorats = [...new Set(govs)].sort();
    const muns = this.allBudgetData.map(item => item.Nom_Municipalite_Ar).filter(Boolean);
    this.listMunicipalites = [...new Set(muns)].sort();
  }

  applyBudgetFilters() {
    this.filteredBudgetData = this.allBudgetData.filter(item => {
      const matchGov = this.selectedGov ? item.Nom_Gouvernorat_Ar === this.selectedGov : true;
      const matchMun = this.selectedMun ? item.Nom_Municipalite_Ar === this.selectedMun : true;
      return matchGov && matchMun;
    });
    this.renderBudgetLayer(this.filteredBudgetData);
  }

  resetFilters() {
    this.selectedGov = '';
    this.selectedMun = '';
    this.applyBudgetFilters();
  }

  renderBudgetLayer(data: any[]) {
    if (this.currentLayer && this.map) {
      this.map.removeLayer(this.currentLayer);
    }

    // L.markerClusterGroup existe forcÃ©ment car chargÃ© par le CDN
    const budgetCluster = L.markerClusterGroup({
      maxClusterRadius: 80,
      iconCreateFunction: (cluster: any) => {
        const markers = cluster.getAllChildMarkers();
        let totalPrevision = 0;
        const govs = new Set();
        const muns = new Set();

        markers.forEach((marker: any) => {
          if (marker.options.previsionAmount) totalPrevision += marker.options.previsionAmount;
          if (marker.options.govName) govs.add(marker.options.govName);
          if (marker.options.munName) muns.add(marker.options.munName);
        });

        let locationLabel = 'Zones Multiples';
        let locationClass = 'mixed';

        if (muns.size === 1) {
          locationLabel = [...muns][0] as string;
          locationClass = 'municipalite';
        } else if (govs.size === 1) {
          locationLabel = [...govs][0] as string;
          locationClass = 'gouvernorat';
        } else {
          locationLabel = 'Divers';
        }

        const formattedSum = new Intl.NumberFormat('fr-TN', { 
          style: 'currency', currency: 'TND', maximumFractionDigits: 0 
        }).format(totalPrevision);

        return L.divIcon({
          html: `<div class="budget-cluster-icon ${locationClass}">
                   <span class="amount">${formattedSum}</span>
                   <span class="location">${locationLabel}</span>
                   <small>(${markers.length} projets)</small>
                 </div>`,
          className: 'budget-cluster',
          iconSize: L.point(100, 100)
        });
      }
    });

    data.forEach(item => {
      const lat = parseFloat(item.lat);
      const lng = parseFloat(item.lng);
      const rawPrevision = item.depenses_prevision ? String(item.depenses_prevision) : '0';
      const valPrevision = parseFloat(rawPrevision.replace(/\s/g, '').replace(',', '.'));

      if (!isNaN(lat) && !isNaN(lng)) {
        const marker = L.marker([lat, lng], {
          icon: L.icon({
            iconUrl: 'assets/marker-icon.png',
            shadowUrl: 'assets/marker-shadow.png',
            iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34]
          })
        });
        
        // Stockage des donnÃ©es
        (marker as any).options.previsionAmount = valPrevision;
        (marker as any).options.govName = item.Nom_Gouvernorat_Ar;
        (marker as any).options.munName = item.Nom_Municipalite_Ar;

        marker.bindPopup(this.generateFullPopup(item));
        budgetCluster.addLayer(marker);
      }
    });

    this.currentLayer = budgetCluster;
    this.map.addLayer(this.currentLayer);
    
    if (data.length > 0) {
        const bounds = budgetCluster.getBounds();
        if (bounds.isValid()) this.map.fitBounds(bounds);
    }
  }

  loadStandardData(category: string) {
    this.mapService.getLocations().subscribe({
      next: (locations) => {
        const filtered = category === 'Toutes' 
          ? locations 
          : locations.filter(l => l.categorie === category);

        const standardCluster = L.markerClusterGroup();

        if (filtered) {
          filtered.forEach(loc => {
            const marker = L.marker([loc.lat, loc.lng], {
              icon: L.icon({
                iconUrl: 'assets/marker-icon.png',
                shadowUrl: 'assets/marker-shadow.png',
                iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34]
              })
            });
            marker.bindPopup(`<b>${loc.nom}</b><br>${loc.categorie}`);
            standardCluster.addLayer(marker);
          });
        }
        this.currentLayer = standardCluster;
        this.map.addLayer(this.currentLayer);
        
        if (filtered && filtered.length > 0) {
           const bounds = standardCluster.getBounds();
           if(bounds.isValid()) this.map.fitBounds(bounds);
        }
      },
      error: (err) => console.error('Erreur Standard:', err)
    });
  }

  generateFullPopup(data: any): string {
    let rows = '';
    for (const key in data) {
      if (data.hasOwnProperty(key) && key !== 'lat' && key !== 'lng') {
         rows += `
          <tr>
            <td style="font-weight:bold; color:#555; padding:3px; border-bottom:1px solid #eee;">${key}</td>
            <td style="padding:3px; border-bottom:1px solid #eee;">${data[key]}</td>
          </tr>`;
      }
    }
    return `<div style="max-height:300px; overflow-y:auto; min-width:250px;">
              <h3 style="margin-top:0; color:#28a745; font-size:14px;">DÃ©tails</h3>
              <table style="width:100%; border-collapse:collapse; font-size:12px;"><tbody>${rows}</tbody></table>
            </div>`;
  }
}

------------------------------
ðŸ“„ Fichier : src/app/app.config.ts
------------------------------
import { ApplicationConfig, provideBrowserGlobalErrorListeners, provideZoneChangeDetection } from '@angular/core';
import { provideHttpClient } from '@angular/common/http';

export const appConfig: ApplicationConfig = {
  providers: [
    provideBrowserGlobalErrorListeners(),
    provideZoneChangeDetection({ eventCoalescing: true }),
    provideHttpClient()
  ]
};

------------------------------
ðŸ“„ Fichier : src/app/app.component.css
------------------------------
/* Layout Principal */
.map-container {
  position: relative;
  height: 100vh;
  width: 100%;
  display: flex;
  flex-direction: column;
}

#map {
  flex-grow: 1;
  width: 100%;
  height: 100%;
  z-index: 1;
}

/* ContrÃ´les */
.map-controls {
  position: absolute;
  top: 20px;
  right: 20px;
  z-index: 1000;
  background: white;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  font-family: 'Segoe UI', Arial, sans-serif;
  min-width: 250px;
  max-width: 300px;
}
.main-select select { width: 100%; padding: 6px; margin-top: 5px; }

/* Filtres */
.filter-container { margin-top: 10px; animation: fadeIn 0.3s ease-in-out; }
.filter-header { display: flex; justify-content: space-between; margin-bottom: 10px; color: #28a745; }
.toggle-btn { background: none; border: none; color: #007bff; font-size: 11px; cursor: pointer; text-decoration: underline; }
.filter-group { margin-bottom: 8px; }
.filter-group label { display: block; font-size: 12px; color: #555; }
.filter-group select { width: 100%; padding: 4px; }
.reset-btn { width: 100%; padding: 6px; margin-top: 5px; background-color: #f8f9fa; border: 1px solid #ddd; cursor: pointer; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }

/* --- CLUSTER BUDGET --- */
::ng-deep .budget-cluster-icon {
  background-color: rgba(40, 167, 69, 0.95);
  border: 2px solid white;
  border-radius: 50%;
  color: white;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 100px; 
  height: 100px; 
  box-shadow: 0 5px 15px rgba(0,0,0,0.4);
  text-align: center;
  cursor: pointer;
  transition: transform 0.2s;
  padding: 5px;
  overflow: hidden;
}

::ng-deep .budget-cluster-icon:hover {
  background-color: #218838;
  transform: scale(1.1);
  z-index: 9999;
}

/* Montant */
::ng-deep .budget-cluster-icon .amount {
  font-weight: bold;
  font-size: 11px;
  line-height: 1.2;
}

/* Nom GÃ©ographique (Gouvernorat/MunicipalitÃ©) */
::ng-deep .budget-cluster-icon .location {
  font-size: 10px;
  font-weight: bold;
  color: #d4edda; /* Vert trÃ¨s clair */
  margin-top: 2px;
  margin-bottom: 2px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 90%;
}

::ng-deep .budget-cluster-icon small {
  font-size: 9px;
  opacity: 0.8;
  font-weight: normal;
}

/* Variation de couleur subtile si c'est une municipalitÃ© prÃ©cise */
::ng-deep .budget-cluster-icon.municipalite {
  background-color: rgba(30, 126, 52, 0.95);
  border-color: #c3e6cb;
}

------------------------------
ðŸ“„ Fichier : src/app/app.html
------------------------------
<div class="map-container">
  
  <div class="map-controls">
    <div class="main-select">
      <label><strong>CatÃ©gorie :</strong></label>
      <select (change)="onCategoryChange($any($event))">
        <option *ngFor="let cat of categories" [value]="cat">
          {{ cat }}
        </option>
      </select>
    </div>

    <div *ngIf="isBudgetActive" class="filter-container">
      <hr>
      <div class="filter-header">
        <strong>Filtres Budget</strong>
        <button class="toggle-btn" (click)="filtersVisible = !filtersVisible">
          {{ filtersVisible ? 'Masquer' : 'Afficher' }}
        </button>
      </div>

      <div *ngIf="filtersVisible" class="filter-body">
        
        <div class="filter-group">
          <label>Gouvernorat :</label>
          <select [(ngModel)]="selectedGov" (change)="applyBudgetFilters()">
            <option value="">(Tous)</option>
            <option *ngFor="let g of listGouvernorats" [value]="g">{{ g }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label>MunicipalitÃ© :</label>
          <select [(ngModel)]="selectedMun" (change)="applyBudgetFilters()">
            <option value="">(Toutes)</option>
            <option *ngFor="let m of listMunicipalites" [value]="m">{{ m }}</option>
          </select>
        </div>

        <button class="reset-btn" (click)="resetFilters()">RÃ©initialiser</button>
      </div>
    </div>
  </div>

  <div id="map"></div>
</div>

------------------------------
ðŸ“„ Fichier : src/app/services/map-data.service.ts
------------------------------
import { Injectable } from '@angular/core';
import { HttpClient } from '@angular/common/http';
import { Observable } from 'rxjs';

@Injectable({
  providedIn: 'root'
})
export class MapDataService {
  constructor(private http: HttpClient) { }

  getLocations(): Observable<any[]> {
    // Les Ã©tablissements classiques (LycÃ©es, etc.)
    return this.http.get<any[]>('assets/all_locations.json');
  }

  getBudget2021(): Observable<any[]> {
    // Le fichier spÃ©cifique Budget
    return this.http.get<any[]>('assets/budget2021.json');
  }
}

------------------------------
ðŸ“„ Fichier : src/app/services/map-data.ts
------------------------------
import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root',
})
export class MapData {
  
}

------------------------------
ðŸ“„ Fichier : src/main.ts
------------------------------
import { bootstrapApplication } from '@angular/platform-browser';
import { appConfig } from './app/app.config';
import { AppComponent } from './app/app.component';

// --- CORRECTIF LEAFLET PRODUCTION ---
// 1. On importe Leaflet
import * as L from 'leaflet';
import 'leaflet.markercluster';

// 2. On force l'exposition globale pour les plugins qui cherchent window.L
(window as any).L = L;

bootstrapApplication(AppComponent, appConfig)
  .catch((err) => console.error(err));

------------------------------
ðŸ“„ Fichier : src/styles.css
------------------------------
/* Import des styles de base Leaflet */
@import "leaflet/dist/leaflet.css";

/* Import des styles pour les clusters (NÃ©cessaire pour la logique, mÃªme si on style par dessus) */
@import "leaflet.markercluster/dist/MarkerCluster.css";
@import "leaflet.markercluster/dist/MarkerCluster.Default.css";

html, body { 
    height: 100%; 
    margin: 0; 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

